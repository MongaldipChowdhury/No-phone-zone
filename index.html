<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>No Phone Zone</title>

  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.0.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>

  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: black;
      font-family: Arial, sans-serif;
    }

    h1 {
      position: absolute;
      top: 10px;
      width: 100%;
      text-align: center;
      color: white;
      z-index: 3;
      font-size: 22px;
    }

    button {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      background: red;
      color: white;
      z-index: 4;
    }

    video, canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      object-fit: cover;
    }

    video { z-index: 1; }
    canvas { z-index: 2; }
  </style>
</head>

<body>

<h1>ðŸš« No Phone Zone ðŸš«</h1>
<button onclick="switchCamera()">Switch Camera</button>

<video id="video" autoplay playsinline></video>
<canvas id="canvas"></canvas>
<audio id="alertSound" src="audio.mp3"></audio>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const alertSound = document.getElementById("alertSound");

let model;
let currentFacingMode = "user";
let stream;
let lastAlertTime = 0;
const COOLDOWN = 11000;
const CONFIDENCE = 0.6;

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

async function setupCamera() {
  if (stream) {
    stream.getTracks().forEach(track => track.stop());
  }

  stream = await navigator.mediaDevices.getUserMedia({
    video: { facingMode: currentFacingMode },
    audio: false
  });

  video.srcObject = stream;
  await video.play();
}

function switchCamera() {
  currentFacingMode = currentFacingMode === "environment" ? "user" : "environment";
  setupCamera();
}

async function detectFrame() {
  const predictions = await model.detect(video);
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  predictions.forEach(prediction => {
    if (prediction.class === "cell phone" && prediction.score > CONFIDENCE) {
      const [x, y, width, height] = prediction.bbox;

      ctx.strokeStyle = "red";
      ctx.lineWidth = 4;
      ctx.strokeRect(x, y, width, height);

      ctx.fillStyle = "red";
      ctx.font = "bold 24px Arial";
      ctx.fillText("PHONE RAKHHH NEECHE!", x, y - 10);

      const now = Date.now();
      if (now - lastAlertTime > COOLDOWN) {
        alertSound.play();
        lastAlertTime = now;
      }
    }
  });

  requestAnimationFrame(detectFrame);
}

async function main() {
  await setupCamera();
  model = await cocoSsd.load();
  detectFrame();
}

main();
</script>

</body>
</html>
